<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>杭州明度智慧司机端 | 叩首问路，码梦为生</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/logo.svg">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#53A8FF">
    <meta name="description" content="你好，我叫郭二蛋，欢迎你来到这里">
    <meta name="theme-color" content="#53A8FF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.6a70634b.css" as="style"><link rel="preload" href="/assets/js/app.856bad6d.js" as="script"><link rel="preload" href="/assets/js/2.6a99c285.js" as="script"><link rel="preload" href="/assets/js/27.e091a131.js" as="script"><link rel="preload" href="/assets/js/8.396b1803.js" as="script"><link rel="prefetch" href="/assets/js/10.960a6655.js"><link rel="prefetch" href="/assets/js/11.3bde5e34.js"><link rel="prefetch" href="/assets/js/12.de934909.js"><link rel="prefetch" href="/assets/js/13.717e8502.js"><link rel="prefetch" href="/assets/js/14.0b0f6fde.js"><link rel="prefetch" href="/assets/js/15.8723ac38.js"><link rel="prefetch" href="/assets/js/16.8db0111f.js"><link rel="prefetch" href="/assets/js/17.70d1e644.js"><link rel="prefetch" href="/assets/js/18.e6853a29.js"><link rel="prefetch" href="/assets/js/19.2fd51b30.js"><link rel="prefetch" href="/assets/js/20.c72340f4.js"><link rel="prefetch" href="/assets/js/21.9d0b3d30.js"><link rel="prefetch" href="/assets/js/22.ce12d2f1.js"><link rel="prefetch" href="/assets/js/23.cfdf6604.js"><link rel="prefetch" href="/assets/js/24.6b70f8b5.js"><link rel="prefetch" href="/assets/js/25.64dd0228.js"><link rel="prefetch" href="/assets/js/26.bd137f35.js"><link rel="prefetch" href="/assets/js/28.e0f88969.js"><link rel="prefetch" href="/assets/js/29.e3fdaaa2.js"><link rel="prefetch" href="/assets/js/3.7031cefa.js"><link rel="prefetch" href="/assets/js/30.115d56d0.js"><link rel="prefetch" href="/assets/js/31.0c91284c.js"><link rel="prefetch" href="/assets/js/32.f436709f.js"><link rel="prefetch" href="/assets/js/33.aec02913.js"><link rel="prefetch" href="/assets/js/34.5f0c80a1.js"><link rel="prefetch" href="/assets/js/35.6c57a5b9.js"><link rel="prefetch" href="/assets/js/36.874bc2bc.js"><link rel="prefetch" href="/assets/js/37.9d3e55d1.js"><link rel="prefetch" href="/assets/js/38.664eac9a.js"><link rel="prefetch" href="/assets/js/39.38e15cf0.js"><link rel="prefetch" href="/assets/js/4.cf227334.js"><link rel="prefetch" href="/assets/js/40.1eb39796.js"><link rel="prefetch" href="/assets/js/41.21813454.js"><link rel="prefetch" href="/assets/js/42.c366e57e.js"><link rel="prefetch" href="/assets/js/43.2ed90fb6.js"><link rel="prefetch" href="/assets/js/44.8b7ed554.js"><link rel="prefetch" href="/assets/js/45.e65eba18.js"><link rel="prefetch" href="/assets/js/46.e219420f.js"><link rel="prefetch" href="/assets/js/47.47adaa89.js"><link rel="prefetch" href="/assets/js/48.1e2c3ed7.js"><link rel="prefetch" href="/assets/js/49.430a2613.js"><link rel="prefetch" href="/assets/js/5.1f81c3e9.js"><link rel="prefetch" href="/assets/js/50.4cb51013.js"><link rel="prefetch" href="/assets/js/51.48e00036.js"><link rel="prefetch" href="/assets/js/52.2e53b9ba.js"><link rel="prefetch" href="/assets/js/53.566a6fbd.js"><link rel="prefetch" href="/assets/js/54.740bb41a.js"><link rel="prefetch" href="/assets/js/55.276e7e98.js"><link rel="prefetch" href="/assets/js/56.42aa3b98.js"><link rel="prefetch" href="/assets/js/57.5c66fa93.js"><link rel="prefetch" href="/assets/js/58.73423f17.js"><link rel="prefetch" href="/assets/js/59.e9354a5e.js"><link rel="prefetch" href="/assets/js/6.e00d9635.js"><link rel="prefetch" href="/assets/js/60.d37d1a47.js"><link rel="prefetch" href="/assets/js/61.5608bf0d.js"><link rel="prefetch" href="/assets/js/62.e318dfd6.js"><link rel="prefetch" href="/assets/js/63.74fca516.js"><link rel="prefetch" href="/assets/js/64.81eb34e4.js"><link rel="prefetch" href="/assets/js/65.ef4b9d8a.js"><link rel="prefetch" href="/assets/js/66.1ff64233.js"><link rel="prefetch" href="/assets/js/67.89044667.js"><link rel="prefetch" href="/assets/js/7.f63888e1.js"><link rel="prefetch" href="/assets/js/9.97c83bcc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a70634b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">叩首问路，码梦为生</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/study/index.html" class="nav-link">
  学习
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  问题
</a></div><div class="nav-item"><a href="/document/index.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/read/index.html" class="nav-link">
  读书
</a></div> <a href="https://github.com/guozhaoxi/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/study/index.html" class="nav-link">
  学习
</a></div><div class="nav-item"><a href="/question/index.html" class="nav-link">
  问题
</a></div><div class="nav-item"><a href="/document/index.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/read/index.html" class="nav-link">
  读书
</a></div> <a href="https://github.com/guozhaoxi/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>杭州明度</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/document/mingdu/driver.html" aria-current="page" class="active sidebar-link">杭州明度智慧司机端</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/mingdu/driver.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/document/mingdu/driver.html#文件目录说明" class="sidebar-link">文件目录说明</a></li><li class="sidebar-sub-header"><a href="/document/mingdu/driver.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/document/mingdu/driver.html#部分功能说明" class="sidebar-link">部分功能说明</a></li><li class="sidebar-sub-header"><a href="/document/mingdu/driver.html#结束语" class="sidebar-link">结束语</a></li></ul></li><li><a href="/document/mingdu/admin.html" class="sidebar-link">杭州明度智慧管控端</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="杭州明度智慧司机端"><a href="#杭州明度智慧司机端" class="header-anchor">#</a> 杭州明度智慧司机端</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>杭州明度智慧司机端，是杭州明度至盛公司研发的自动装车设备的前端方案。它基于前端框架<a href="https://cn.vuejs.org/" target="_blank" rel="noopener noreferrer">vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来实现，面向的用户人群主要以货车司机为主，为用户方提供了便利的装车方案，我们来简单介绍一下项目，方便以后的人来接手项目。</p> <h2 id="文件目录说明"><a href="#文件目录说明" class="header-anchor">#</a> 文件目录说明</h2> <p>项目的资源文件/入口文件/组件代码/路由/全局状态管理等都存放在src目录下，我们简单的介绍一下每个文件夹存放的内容是什么（对于有经验的同事来说，看到文件夹名称就能知道）</p> <h4 id="assets"><a href="#assets" class="header-anchor">#</a> assets</h4> <p>这里存放的是我们要用到的一些静态资源文件，比如图片和css文件，打包的时候也会被压缩打包。</p> <h4 id="components"><a href="#components" class="header-anchor">#</a> components</h4> <p>这里存放的是我们自己封装的的自定义组件。</p> <h4 id="connect"><a href="#connect" class="header-anchor">#</a> connect</h4> <p>这个目录下面存放的是我们之前的同事自己封装的ajax请求方法，websocket客户端，以及websocket的事件列表以及要跳转的路由列表。</p> <h4 id="pages"><a href="#pages" class="header-anchor">#</a> pages</h4> <p>所有的页面文件都存放于这个目录下面。</p> <h4 id="router"><a href="#router" class="header-anchor">#</a> router</h4> <p>这里存放的是路由配置文件。</p> <h4 id="store"><a href="#store" class="header-anchor">#</a> store</h4> <p>这里存放的是全局状态。</p> <h4 id="util"><a href="#util" class="header-anchor">#</a> util</h4> <p>这里面封装的都是一些工具方法。</p> <h4 id="app-vue"><a href="#app-vue" class="header-anchor">#</a> App.vue</h4> <p>根组件。</p> <h4 id="main-js"><a href="#main-js" class="header-anchor">#</a> main.js</h4> <p>入口文件，在这里，我们可以引入一些第三方库和全局的一些配置 比如路由 全局状态管理等。</p> <h2 id="配置"><a href="#配置" class="header-anchor">#</a> 配置</h2> <p>配置的路径为public/config.js，之所以放在public目录下是因为vue项目在打包的时候不会将public目录下的文件进行压缩打包，我们有不同的用户方，他们的一些配置也是不同的，所以将此文件放置在public目录下。
我们简单说一下这几个配置项。</p> <h4 id="vue-config-js"><a href="#vue-config-js" class="header-anchor">#</a> vue.config.js</h4> <p>vue-cli相关的配置文件，这里呢可以配置我们打包时候的一些行为，具体参考<a href="https://cli.vuejs.org/zh/guide/" target="_blank" rel="noopener noreferrer">vue-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="topic"><a href="#topic" class="header-anchor">#</a> topic</h4> <p>websocket对应的url地址</p> <h4 id="backendurl"><a href="#backendurl" class="header-anchor">#</a> backendURL</h4> <p>接口地址，这里注意要区分开发环境/生产环境</p> <h4 id="authorization"><a href="#authorization" class="header-anchor">#</a> Authorization</h4> <p>发送请求时添加到请求头当中的一个标识符，默认为'driver'</p> <h4 id="keyboard"><a href="#keyboard" class="header-anchor">#</a> Keyboard</h4> <p>刷卡订单功能需要，默认为分号。当我们刷卡以后，会拿到一个字符串，这个字符串是以分号开始的，我们在后续的业务当中会判断是否具有这个符号，从而进行下一步的逻辑。</p> <h4 id="swipingcardurl"><a href="#swipingcardurl" class="header-anchor">#</a> SwipingCardURL</h4> <p>刷卡接口地址</p> <h4 id="conversionofnumber"><a href="#conversionofnumber" class="header-anchor">#</a> conversionOfNumber</h4> <p>是否需要进制转换，刷卡功能需要，默认为true</p> <h4 id="isdetectionordererror"><a href="#isdetectionordererror" class="header-anchor">#</a> isDetectionOrderError</h4> <p>是否需要检测订单异常信息，默认为true。如果开启状态，那么当后端检测到刷卡订单异常的话，会主动给前端推送一个消息，前端进行展示。</p> <h4 id="页面支持右键菜单"><a href="#页面支持右键菜单" class="header-anchor">#</a> 页面支持右键菜单</h4> <p>我们这个项目要求最终上线的时候是不允许用户自己右键查看的，但是开发的时候又免不了要用右键菜单，所以我们在public/index.html的body标签上 配置一下oncontextmenu,当它为true的时候支持，false的时候不支持。</p> <h2 id="部分功能说明"><a href="#部分功能说明" class="header-anchor">#</a> 部分功能说明</h2> <p>其实这个项目不算复杂，只是刚接手的同事可能会像丈二和尚摸不着头脑，这里简单的写几个我认为是难点的地方，便于后来的同事接手项目可以快速上手和定位问题。</p> <h4 id="刷卡"><a href="#刷卡" class="header-anchor">#</a> 刷卡</h4> <p>因为当我们刷了卡以后，会给我们带来一个以分号开头的字符串，并且会按下回车键。那么我们要做的就是拿到这个订单号，利用http协议发送给后端。话不多说，我们来看一下代码是怎么实现的。</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function-variable function">onkeydown</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> key <span class="token operator">=</span> e<span class="token punctuation">.</span>key
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keyCode<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>Keyboard<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keyCode<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keyCode<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>conversionOfNumber<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            str <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stringToHex</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>str <span class="token operator">===</span> <span class="token string">'gitversion'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isGit <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 刷卡订单逻辑</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>
              localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'laneId'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'1'</span> <span class="token operator">&amp;&amp;</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/home/hello'</span>
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">{</span> baseUrl<span class="token operator">:</span> window<span class="token punctuation">.</span>SwipingCardURL <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/v1/loading?cardNO='</span> <span class="token operator">+</span> str<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>isCardError <span class="token operator">=</span> <span class="token boolean">false</span>
                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>isCardError <span class="token operator">=</span> <span class="token boolean">true</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>isCardErrorMsg <span class="token operator">=</span> res<span class="token punctuation">.</span>msg
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyCode <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> window<span class="token punctuation">.</span>Keyboard<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyCode <span class="token operator">=</span> window<span class="token punctuation">.</span>Keyboard
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">!==</span> window<span class="token punctuation">.</span>Keyboard<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyCode <span class="token operator">+=</span> key
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>上面这段代码的逻辑也十分简单，我们监听了回车事件，然后拿到这个以分号为开头的订单号，用js的原生api进行截取，去掉分号，就是我们要传递给后端的单号，只要拿到单号，发送给后端，我们的任务就完成了。在这里要注意，我们做了一个判断来决定是否需要对单号进行进制转换。</p> <h4 id="路由的跳转"><a href="#路由的跳转" class="header-anchor">#</a> 路由的跳转</h4> <p>说到路由的跳转，只要是用过vue的人都知道是用vue-router来实现的。我们这个项目也不例外，只是调用vue-router的地方和我们以往的项目不同，因为我们这个项目用了websocket，用来和后端进行实时通讯。后端和上位机进行通讯以后拿到状态，然后再通过websocket来和前端通讯，前端拿到对应的事件类型以后做判断，我们随便
拿一个例子来说一下。<br>
我们项目中监听websocket事件的方法定义在pages/home.vue中，有一个叫dealResult的方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">dealResult</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'NOTIFY_COMMAND_CANCEL_ORDER'</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$http
                <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>
                   <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v3/taskexecutor/terminate/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'laneId'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
                 <span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                 <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我这里只贴了一部分的代码，但是也足以表达意思。后端推送给我们的消息对象就是我们这个函数的参数res,我们来判断它的command，从而作出对应的操作。上面这是一个取消订单的事件，那么我们就需要把对应的参数通过http协议传递给后盾啊，从而跳转到首页。</p> <h4 id="装车动画"><a href="#装车动画" class="header-anchor">#</a> 装车动画</h4> <p>要说这个项目中最复杂的地方，应该就属于我们的装车动画了。我们装车页面是pages/loading/process.vue,那么我们的装车动画呢，实际上是封装了一个自定义组件，它的目录是在pages/carAnimation/index.vue。
我们简单说一下它的实现逻辑，首先，我们的装车动画分为直视图和俯视图，所以我们要有两个画布，这里使用的是HTML5所带来的新特性canvas。关于canvas的语法其实并不难，多看一下就能掌握了。</p> <p>我们通过后端接口获取到车辆的基本信息，然后按照一定的比例进行缩放到我们的页面上来，车的简易图使用的也是canvas来进行绘制的，这些绘制基本属性的方法被封装在来一个单独的类中。当我们的简易图绘制好了以后，现在的页面是静态的，但是装车是实时的，所以要让我们的简易图动起来，那么如何做这个事呢？<br>
答案显而易见，我们要借助于websocket，通过它拿到后端发给我们的每一包水泥的坐标，每装一包水泥，就返回给我们一个坐标，然后我们拿到这个坐标以后，去绘制。这里还需要注意的一个问题就是，当我们刷新页面以后，还要重新获取一下已经装包的数量，把它们也绘制出来。
canvas提供了橡皮擦，可以让我们擦掉一个区域，这样机头看上去就只有一个一直在随坐标的改变而变化，给人一种动画的感觉。
由于代码量大，就不贴具体的实现方法，大家可以自行打开源码去里面看。</p> <h4 id="手动订单确认之前加一个密码输入"><a href="#手动订单确认之前加一个密码输入" class="header-anchor">#</a> 手动订单确认之前加一个密码输入</h4> <p>添加日期：2021.11.10</p> <p>用到的组件：iview中的Modal/Message</p> <p>逻辑：获取垛型参数列表，拿到我们想要的配置，然后根据这个值来判断是否需要密码验证，如果为true我们就会要求用户输入密码，和我们设置的密码一致的情况下，就允许确认，如果不需要验证，直接可以确认。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">getStackingParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v3/stacking/query/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'stackingId'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> parasList <span class="token operator">=</span> result<span class="token punctuation">.</span>result<span class="token punctuation">.</span>paras
        <span class="token comment">// 过滤找出我们的那一项配置</span>
        <span class="token keyword">const</span> option <span class="token operator">=</span> parasList<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'WHETHER_TO_CHECK'</span>
        <span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isOpenValidate <span class="token operator">=</span> option<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">'1'</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token function">handleRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$Modal<span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'Input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            props<span class="token operator">:</span> <span class="token punctuation">{</span>
              value<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">,</span>
              autofocus<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              placeholder<span class="token operator">:</span> <span class="token string">'请输入密码'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            on<span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token function-variable function">input</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> val
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token string">'on-blur'</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">===</span> <span class="token string">'mdzh8888'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>$Message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'密码输入错误'</span><span class="token punctuation">)</span>
                  <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

   <span class="token function">affirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isOpenValidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRender</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">sendOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token keyword">let</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formItem<span class="token punctuation">)</span>
      <span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token string">'手动'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'driver'</span>
      obj<span class="token punctuation">.</span>name <span class="token operator">=</span> number
      obj<span class="token punctuation">.</span>orderNo <span class="token operator">=</span> number
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isError <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/v3/taskexecutor/order/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'laneId'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          obj
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="结束语"><a href="#结束语" class="header-anchor">#</a> 结束语</h2> <p>关于杭州明度智慧司机端项目的文档暂时就先写到这里，其实项目页面没几个，只是刚接手的人面对一些目录结构可能会有点不知道如何下手，希望自己输出的这篇文档能够帮助到后来的人快速的接手项目。写的很笼统，后面有时间的话再进行详细的补充</p> <p>本文完。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/guozhaoxi/edit/master/docs/document/mingdu/driver.md" target="_blank" rel="noopener noreferrer">编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/10/2021, 1:45:41 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/document/mingdu/admin.html">
        杭州明度智慧管控端
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.856bad6d.js" defer></script><script src="/assets/js/2.6a99c285.js" defer></script><script src="/assets/js/27.e091a131.js" defer></script><script src="/assets/js/8.396b1803.js" defer></script>
  </body>
</html>
